# 12 å¯è§†åŒ–

## 1 ä»‹ç»

Foxglove æ˜¯ä¸€æ¬¾ä¸“ä¸ºæœºå™¨äººé¢†åŸŸè®¾è®¡çš„å¼ºå¤§å¼€æºæ•°æ®å¯è§†åŒ–ä¸è°ƒè¯•å·¥å…·ã€‚å®ƒé€šè¿‡æä¾›ç›´è§‚çš„å¯è§†åŒ–ç•Œé¢å’Œä¸°å¯Œçš„åŠŸèƒ½ï¼Œå¸®åŠ©å¼€å‘è€…ã€ç ”ç©¶äººå‘˜æ›´é«˜æ•ˆåœ°ç†è§£ã€åˆ†æå’Œè°ƒè¯•æœºå™¨äººç³»ç»Ÿçš„å¤æ‚æ•°æ®ã€‚

ä¸‹é¢è¿™ä¸ªè¡¨æ ¼æ±‡æ€»äº† Foxglove çš„ä¸€äº›æ ¸å¿ƒåŠŸèƒ½ä¸ç‰¹ç‚¹ï¼Œæ–¹ä¾¿ä½ å¿«é€Ÿäº†è§£ï¼š

| åŠŸèƒ½ç±»åˆ«           | æ ¸å¿ƒèƒ½åŠ›                                                     | å¤‡æ³¨/ç¤ºä¾‹                                              |
| :----------------- | :----------------------------------------------------------- | :----------------------------------------------------- |
| **ğŸ¤– æ•°æ®æ”¯æŒ**     | æ”¯æŒ ROS 1ã€ROS 2ã€MCAP ç­‰å¤šç§æ•°æ®æ ¼å¼å’Œåè®®                 | å¯è¿æ¥å®æ—¶ç³»ç»Ÿæˆ–å›æ”¾è®°å½•çš„ bag æ–‡ä»¶ã€MCAP æ–‡ä»¶ç­‰ã€‚     |
| **ğŸ–¥ï¸ å¤šæ¨¡æ€å¯è§†åŒ–** | æä¾› 3D è§†å›¾ã€æ¿€å…‰é›·è¾¾ç‚¹äº‘ã€å›¾åƒè§†é¢‘ã€å›¾è¡¨ç»˜åˆ¶ã€æ—¥å¿—æŸ¥çœ‹ç­‰å¤šç§å¯è§†åŒ–é¢æ¿ | å…è®¸ç”¨æˆ·è‡ªå®šä¹‰é¢æ¿å¸ƒå±€ï¼Œæ»¡è¶³ç‰¹å®šè°ƒè¯•éœ€æ±‚ã€‚             |
| **ğŸ”§ è°ƒè¯•ä¸è¯Šæ–­**   | æŸ¥çœ‹è¯Šæ–­ä¿¡æ¯ã€å‚æ•°ç®¡ç†ã€è¯é¢˜å‘å¸ƒã€è¿œç¨‹æ“ä½œï¼ˆTeleopï¼‰ç­‰åŠŸèƒ½   | æ”¯æŒåœ¨å·¥å…·å†…ç›´æ¥ä¿®æ”¹å‚æ•°æˆ–å‘å¸ƒæŒ‡ä»¤ï¼Œä¸æœºå™¨äººç³»ç»Ÿäº¤äº’ã€‚ |
| **ğŸŒ åä½œä¸å…±äº«**   | æ”¯æŒå¸ƒå±€ä¿å­˜å’Œå…±äº«ï¼Œæ–¹ä¾¿å›¢é˜Ÿåä½œ                             | ç»Ÿä¸€çš„è§†å›¾é…ç½®æœ‰åŠ©äºä¿æŒå›¢é˜Ÿåˆ†æçš„ä¸€è‡´æ€§ã€‚             |
| **âš™ï¸ éƒ¨ç½²ä¸æ‰©å±•**   | æä¾›æ¡Œé¢å®¢æˆ·ç«¯ã€Web ç«¯ä»¥åŠè‡ªæ‰˜ç®¡é€‰é¡¹                         | æ”¯æŒä½¿ç”¨ JavaScript å¼€å‘è‡ªå®šä¹‰é¢æ¿ï¼Œæ‰©å±•æ€§å¼ºã€‚         |

Foxglove çš„æ ¸å¿ƒä¼˜åŠ¿åœ¨äºå®ƒèƒ½å°†æœºå™¨äººç³»ç»Ÿä¸­å„ç§**ä¸åŒç±»å‹çš„æ•°æ®ï¼ˆå¤šæ¨¡æ€æ•°æ®ï¼‰** åœ¨**ç»Ÿä¸€çš„ç•Œé¢**ä¸­è¿›è¡Œå¯è§†åŒ–å…³è”åˆ†æï¼š

- **3D å¯è§†åŒ–**ï¼šåœ¨**3D è§†å›¾**ä¸­ï¼Œä½ ã€å¯ä»¥åŒæ—¶æ˜¾ç¤ºæœºå™¨äººçš„**è¿åŠ¨è½¨è¿¹**ã€**ä¼ æ„Ÿå™¨æ•°æ®ï¼ˆå¦‚æ¿€å…‰é›·è¾¾ç‚¹äº‘ã€æ·±åº¦å›¾åƒï¼‰**å’Œ**ç¯å¢ƒä¿¡æ¯ï¼ˆå¦‚åœ°å›¾ã€éšœç¢ç‰©ï¼‰**ã€‚è¿™å¯¹äº**æ„ŸçŸ¥ç®—æ³•éªŒè¯**ã€**å¯¼èˆªè°ƒè¯•**å’Œ**æ•´ä½“ç³»ç»Ÿè¡Œä¸ºç†è§£**è‡³å…³é‡è¦ã€‚
- **æ—¶é—´åºåˆ—æ•°æ®ç»˜å›¾**ï¼š**Plot é¢æ¿**å¯ä»¥ç»˜åˆ¶ä»»ä½•æ•°å€¼å‹æ•°æ®éšæ—¶é—´å˜åŒ–çš„æ›²çº¿ï¼Œéå¸¸é€‚åˆåˆ†æ**ä¼ æ„Ÿå™¨è¯»æ•°**ã€**æ§åˆ¶æŒ‡ä»¤**ã€**çŠ¶æ€ä¼°è®¡**ç­‰æ•°æ®çš„å˜åŒ–è¶‹åŠ¿å’Œç›¸äº’å…³ç³»ã€‚
- **å›¾åƒä¸è§†é¢‘æµæŸ¥çœ‹**ï¼š**Image é¢æ¿**èƒ½å¤Ÿå®æ—¶æ˜¾ç¤ºæœºå™¨äººæ‘„åƒå¤´é‡‡é›†çš„**å›¾åƒæˆ–è§†é¢‘æµ**ï¼Œç”¨äº**è§†è§‰ç®—æ³•**çš„è°ƒè¯•å’Œç›‘æ§ã€‚
- **æ—¥å¿—ä¸åŸå§‹æ¶ˆæ¯**ï¼š**Log é¢æ¿**å’Œ**Raw Messages é¢æ¿**è®©ä½ å¯ä»¥æŸ¥çœ‹ç³»ç»Ÿçš„**æ—¥å¿—è¾“å‡º**å’Œ**åŸå§‹æ¶ˆæ¯å†…å®¹**ï¼Œä¾¿äºè¿›è¡Œ**ç»†èŠ‚æ’æŸ¥**å’Œ**æ•°æ®è§£æ**

## 2 å¦‚ä½•ä½¿ç”¨ï¼Ÿ

* **ä¸‹è½½** ï¼š[foxglove studio](https://foxglove.dev/download)ã€‚ä½ å¯ä»¥ä»å®˜ç½‘ä¸‹è½½ **æ¡Œé¢å®¢æˆ·ç«¯**ï¼ˆæ”¯æŒ Windows, macOS, Linuxï¼‰ï¼Œæˆ–ç›´æ¥åœ¨ç°ä»£æµè§ˆå™¨ä¸­è®¿é—® **Web ç‰ˆæœ¬**ã€‚
* **è¿æ¥æ•°æ®æº**ï¼š
  - å¯¹äº**å®æ—¶æ•°æ®**ï¼Œé€šå¸¸éœ€è¦åœ¨æœºå™¨äººç³»ç»Ÿä¸Šè¿è¡Œ **foxglove_bridge** æˆ– **rosbridge_server**ï¼Œç„¶ååœ¨ Foxglove ä¸­é€‰æ‹©å¯¹åº”çš„ WebSocket è¿æ¥æ–¹å¼å¹¶è¾“å…¥åœ°å€ã€‚
  - å¯¹äº**ç¦»çº¿æ•°æ®**ï¼Œç›´æ¥å°†æœ¬åœ°çš„ bag æ–‡ä»¶æˆ– MCAP æ–‡ä»¶**æ‹–æ‹½**åˆ° Foxglove ç•Œé¢ä¸­å³å¯æ‰“å¼€ã€‚
* **é…ç½®å¸ƒå±€**ï¼šæ ¹æ®ä½ çš„è°ƒè¯•éœ€æ±‚ï¼Œä»å·¦ä¾§æ·»åŠ æ‰€éœ€çš„**å¯è§†åŒ–é¢æ¿**ï¼ˆå¦‚ 3Dã€Plotã€Imageã€Log ç­‰ï¼‰ï¼Œå¹¶è®¢é˜…ç›¸åº”çš„è¯é¢˜æˆ–æ•°æ®å­—æ®µã€‚
* **åˆ†æä¸è°ƒè¯•**ï¼šåˆ©ç”¨æ—¶é—´è½´æ§åˆ¶æ’­æ”¾ï¼Œè§‚å¯Ÿä¸åŒé¢æ¿ä¸­çš„æ•°æ®å…³è”ï¼Œä»è€Œå‘ç°é—®é¢˜æˆ–éªŒè¯ç®—æ³•ã€‚

<img src="./images/foxglove.png" alt="path" style="zoom:56%;" />

## 3 æ”¯æŒçš„æ•°æ®ç±»å‹

* commsgs::sensor_msgs::Image

* commsgs::sensor_msgs::CameraInfo
* commsgs::sensor_msgs::CompressedImage
* commsgs::sensor_msgs::LaserScan
* commsgs::sensor_msgs::Imu
* commsgs::sensor_msgs::PointCloud
* commsgs::sensor_msgs::PointCloud2
* commsgs::sensor_msgs::PointCloud
* commsgs::sensor_msgs::Range
* commsgs::geometry_msgs::Point
* commsgs::geometry_msgs::PointStamped
* commsgs::geometry_msgs::Polygon
* commsgs::geometry_msgs::PolygonStamped
* commsgs::geometry_msgs::Pose2D
* commsgs::geometry_msgs::Pose
* commsgs::geometry_msgs::PoseArray
* commsgs::geometry_msgs::PoseStamped
* commsgs::geometry_msgs::Transform
* commsgs::geometry_msgs::TransformStamped
* commsgs::geometry_msgs::TransformStampeds
* commsgs::map_msgs::OccupancyGrid
* commsgs::map_msgs::OccupancyGridUpdate
* commsgs::map_msgs::Octomap
* commsgs::map_msgs::GridMap
* commsgs::planning_msgs::Path
* commsgs::planning_msgs::Odometry
* commsgs::vision_msgs::BoundingBox2D
* commsgs::vision_msgs::BoundingBox2DArray
* commsgs::vision_msgs::Point2D
* commsgs::vision_msgs::Pose2D
* commsgs::vision_msgs::BoundingBox3D
* commsgs::vision_msgs::BoundingBox3DArray
* commsgs::vision_msgs::ObjectHypothesis
* commsgs::vision_msgs::Classification
* commsgs::vision_msgs::ObjectHypothesisWithPose
* commsgs::vision_msgs::Detection2D
* commsgs::vision_msgs::Detection2DArray
* commsgs::vision_msgs::Detection2D
* commsgs::vision_msgs::Detection3D
* commsgs::vision_msgs::Detection3DArray
* commsgs::vision_msgs::LabelInfo

## 4 Examples

| åºå· |   åŠŸèƒ½   |                            å¯è§†åŒ–                            |
| :--: | :------: | :----------------------------------------------------------: |
|  1   | æ˜¾ç¤ºè·¯å¾„ | <img src="./images/path.png" alt="path" style="zoom:20%;" /> |
|  2   | æ˜¾ç¤ºåœ°å›¾ | <img src="./images/map.png" alt="path" style="zoom:20%;" />  |
|  3   | å®æ—¶æ›²çº¿ | <img src="./images/curve2.png" alt="path" style="zoom:20%;" /> |

* åˆ›å»ºæœåŠ¡å™¨

```C++
#include "autonomy/visualization/visualization_server.hpp"

VisualizationServer::SharedPtr GetServer()
{
    proto::VisualizationOptions options;
    options.set_host("0.0.0.0");
    options.set_port(8765);
    options.set_mcap_filename("");
    options.set_write_mcap_data(false);
    return std::make_shared<VisualizationServer>(options);
}
```

* æ˜¾ç¤ºè·¯å¾„

```c++
commsgs::planning_msgs::Path CreatePathMsgs()
{
    commsgs::planning_msgs::Path msgs;
    msgs.header.frame_id = "map";

    const float CENTER_X = 0.5f;
    const float CENTER_Y = 0.0f;
    const float RADIUS = 2.8f;
    const int NUM_POINTS = 100;
    for (int i = 0; i < NUM_POINTS; ++i) {

        commsgs::geometry_msgs::PoseStamped pose;
        float angle = 2.0f * M_PI * i / NUM_POINTS;
        pose.pose.position.x = CENTER_X + RADIUS * cos(angle);
        pose.pose.position.y = CENTER_Y + RADIUS * sin(angle);
        pose.pose.position.z = 0.0;
        msgs.poses.push_back(pose);
    }
    return msgs;
}

server->Publish<commsgs::planning_msgs::Path>("path", std::move(path));
std::this_thread::sleep_for(std::chrono::seconds(1));
```

* æ˜¾ç¤ºåœ°å›¾

```c++
commsgs::map_msgs::OccupancyGrid CreateMapMsgs()
{
    std::string yaml_file = "/workspace/autonomy/configuration_files/map/turtlebot3_house.yaml";
    LOG(INFO) << "map_file: " << yaml_file;

    commsgs::map_msgs::OccupancyGrid map_data;
    if (map::costmap_2d::loadMapFromYaml(yaml_file, map_data) != map::costmap_2d::LOAD_MAP_STATUS::LOAD_MAP_SUCCESS) {
        LOG(ERROR) << "Load yaml file error.";
        return map_data;
    }

    return map_data;
}

server->Publish<commsgs::planning_msgs::Path>("path", std::move(map));
std::this_thread::sleep_for(std::chrono::seconds(1));
```

* æ˜¾ç¤ºæ›²çº¿

```C++
commsgs::geometry_msgs::Point CreatePointMsgs()
{
    commsgs::geometry_msgs::Point msgs;
    msgs.x = autonomy::common::math::RandomUniformInteger(0, 100);
    msgs.y = autonomy::common::math::RandomUniformInteger(0, 50);
    msgs.z = autonomy::common::math::RandomUniformInteger(0, 60);
    return msgs;
}

auto point = CreatePointMsgs();
server->Publish<commsgs::geometry_msgs::Point>("curve", std::move(point));
```

